<?xml version="1.0" encoding="utf-8"?>
<mdscript name="One_Sector"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../xsd/md.xsd">
  <cues>
    <cue name="Begin">
      <conditions>
        <check_any>
          <event_game_loaded />
          <event_game_started />
          <event_player_created />
          <event_cue_signalled cue="md.Setup.Start" />
        </check_any>
      </conditions>
      <actions>
        <set_value name="global.$OneSector" exact="this" />
        <set_value name="this.$Debug" exact="0" />
        <create_group groupname="$PlanetaryStations" />
        <do_if value="$InitSetup" exact="true" />
      </actions>
      <cues>
        <cue name="Init">
          <conditions>
            <check_any>
              <event_game_loaded />
              <event_game_started />
              <event_player_created />
              <event_cue_signalled />
            </check_any>
            <check_value value="not @player.allmodules.{player.module}.isscenario" />
          </conditions>
          <delay exact="1ms" />
          <actions>
            <set_value name="$Debug" exact="100" />
            <do_if value="$InitSetup">
              <signal_cue_instantly cue="InitSetup" />
            </do_if>
            <do_else>
              <reset_cue cue="Init" />
            </do_else>
          </actions>
          <cues>
            <cue name="InitSetup" instantiate="true">
              <conditions>
                <event_cue_signalled />
              </conditions>
              <delay exact="1ms" />
              <actions>
                <!-- setup initial planetary stations -->
                <do_for_each name="$macro" in="[
                  swi_clusternarshadda_sector001_macro,
                  swi_clustereriadu_sector001_macro,
                  swi_clusteranpath_sector001_macro,
                  swi_clustercantonica_sector001_macro,
                  swi_clusterhypori_sector001_macro,
                  swi_clustermandalore_sector001_macro,
                  swi_clustercoruscant_sector001_macro,
                  swi_clusterlahmu_sector001_macro
                ]">
                  <find_sector name="$sector" macro="$macro" />
                  <!-- add planetary tradestation -->
                  <run_actions ref="md.LIB_Generic.GetPositionBetweenObjects" result="$posrot">
                    <param name="FromObject" value="$sector" />
                    <param name="ToObject" value="$sector.cluster.planets.{1}" />
                    <param name="Distance01" value="0" />
                    <param name="Distance_Absolute" value="100km" />
                  </run_actions>
                  <get_module_set_macro result="$StationMacro" race="faction.galempire.primaryrace" type="'tradingstation'" />
                  <create_station rawname="'{20777,3002}'"
                    name="$station"
                    state="componentstate.operational"
                    sector="$sector"
                    owner="$sector.owner" macro="$StationMacro"
                    constructionplan="'planetary_tradestation'">
                    <safepos value="$posrot.$position" space="$sector" allowyaxis="false" includeplotbox="true" />
                  </create_station>
                  <set_loadout_level object="$station" exact="1" />
                  <signal_objects object="player.galaxy" param="'init station'" param2="$station"
                    param3="false" />
                  <signal_cue_instantly cue="md.SW_planetaryaid.AddStation" param="table[$Station = $station, $Prefill = true]" />
                </do_for_each>
                <set_value name="$InitSetup" exact="false" />
                <reset_cue cue="parent" />
              </actions>
            </cue>
          </cues>
        </cue>
      </cues>
    </cue>
  </cues>
</mdscript>